# Конфигурационное управление: практическая работа 1
***Вариант №9***<br/>
**Этап 5. Дополнительные команды**

Программа `shell.py` представляет собой эмулятор для языка оболочки ОС, работа с которым напоминает работу в командной строке UNIX-подобной ОС.<br/>
Большинство основных функций из оболочки уже реализованы. Так же есть возможность настройки эмулятора через параметры запуска, позволяющей выбрать файл VFS и выполнить определенный стартовый скрипт.<br/>

## Функционал

- При запуске данной программы высвечивается приглашение к вводу, которое содержит следующую информацию: имя пользователя, от имени которого запущен скрипт; имя хоста; путь до рабочей директории.<br/>
Вот как к примеру будет выглядеть приглашение к вводу пользователя `user` на машине с именем `THISPC`, если программа запущена из его домашней директории (`~`):
```
user@THISPC:~$
```

- Реализованы наиболее используемые команды и настоящей оболочки: `ls`, `cd`, `tree`, `cat`, `uptime`, `cp`.
```
user@THISPC:~$ cd git
user@THISPC:~/git$ ls
kisscm
user@THISPC:~/git$
```

- Реализована поддержка кавычек для команд.
```
user@THISPC:~$ cd "Programs and Files"
user@THISPC:~/Programs and Files$
```

- При некорректной расстановке кавычек парсер оповестит пользователя об ошибке.
```
user@THISPC:~$ ls "uiop
Parser error: No closing quotation
user@THISPC:~$
```

- Пользователь может завершить работу программы командой `exit`.
```
user@THISPC:~$ exit
```

- Эмулятор умеет работать со стартовыми скриптами, которые представляют из себя набор команд для выполнения после загрузки эмулятора. В стартовых скриптах можно оставлять коментарии при помощи `#`. Ниже приведен пример подобного скрипта:
```
# This is a comment
cd ~/git
ls kisscm
```

- Пользователю предоставляется возможность указать путь до файла VFS и стартового скрипта в параметрах запуска эмулятора.
```
$ python3 shell.py --vfs=/путь/до/vfs --script=/путь/до/стартового/скрипта
```

- Если указан переключатель `-s`, то пользователь может переключать режим работы эмулятора между реальной файловой системой компьютера и VFS используя команду `switchfs`.
```
$ python3 shell.py -s --vfs=/путь/до/vfs
...
user@THISPC:/$ switchfs
Shell is now working in ::real FS:: mode
user@THISPC:~$ switchfs
Shell is now working in ::VFS:: mode
user@THISPC:/$
```

- VFS полностью поддерживаются как и в двоичном виде, так и в формате XML (в последующих примерах отражена работа со стандартными файлами проекта defaultvfs.xml и defaultvfs.bin, файл VFSVERSION прописан в самих файлах и используется только в целях демонстрации)
```
$ python3 shell.py --vfs=defaultvfs.xml
...

[VFS] Built!

user@THISPC:/$ cat VFSVERSION
XML
user@THISPC:/$
```
```
$ python3 shell.py --vfs=defaultvfs.bin
...

[VFS] Built!

user@THISPC:/$ cat VFSVERSION
BINARY
user@THISPC:/$
```

## Запуск

### Быстрый старт

Для запуска и корректной работы эмулятора необходима <a href='https://www.python.org/downloads/'>актуальная версия Python 3</a>.

После установки Python (если потребовалось) склонируйте репозиторий (`git clone https://github.com/IlyUniv/Uni-CoUp-Prac1.git`) а затем запустите скрипт `shell.py` в его корневой директории:
```
cd Uni-CoUp-Prac1
python3 shell.py
```

### Параметры запуска

| Параметр | Описание |
| --- | --- |
| `-h`, `--help` | Показать помощь |
| `--vfs=VFS`, `--vfs VFS` | Абсолютный или относительный путь к файлу VFS |
| `--script=SCRIPT`, `--script SCRIPT` | Абсолютный или относительный путь к стартовому скрипту |

###  Скрипты запуска

В репозитории есть несколько скриптов для быстрого запуска или тестирования программы:

- `start_cmdcheck.sh`: запускает эмулятор со стандартными файлом VFS (`defaultvfs.xml`) и скриптом `scripts/defcmdcheck`, который тестирует все реализованные на этом этапе команды, их режимы и обработку ошибок. 

- `start_cwdscript.sh`: запускает эмулятор, который ищет стартовый скрипт `shellscript` в рабочем каталоге (для тестирования данной функции, запускаемых в стартовом скрипте, в корне репозитория располагается одноименный стартовый скрипт).

- `start_default.sh`: запускает эмулятор со стандартными файлом VFS (`defaultvfs.xml`) и стартовым скриптом, в котором тестируются все режимы команд на предыдущих этапах (`scripts/default`). Данный скрипт устарел.

- `start_shellemu.sh`: запускает эмулятор со скриптом `shellscript` и файлом VFS `vfs.xml` в директории `shellemu` пользователя (удобно для создания отдельных конфигураций эмулятора для каждого пользователя).

- `start_vfstest_minimal.sh`: запускает эмулятор с тестовым VFS: 0_minimal.xml
- `start_vfstest_fewfiles.sh`: запускает эмулятор с тестовым VFS: 1_fewfiles.xml
- `start_vfstest_nested.sh`: запускает эмулятор с тестовым VFS: 2_nested.xml

## Использование

### Использование эмулятора

- Для работы пользвателю предоставляется определенный набор комманд. Функционал команд максмиально схож с функционалом их оригиналов из реальной UNIX оболочки. На данный момент поддерживаются: `cd`, `ls`, `tree`, `cat`, `uptime`, `cp`.
```
user@THISPC:~$ cd Documents
user@THISPC:~/Documents$
```
```
user@THISPC:~$ ls "Shared Files"
shared_file1.txt
shared_file2.docx
user@THISPC:~$
```

- Чтобы переключаться между режимами работы между VFS и реальной файловой системой компьютера, используйте команду `switchfs`. Помните, что для её работы необходмо указать переключатель `-s` при запучке оболчки.
```
user@THISPC:/$ switchfs
Shell is now working in ::real FS:: mode
user@THISPC:~$ switchfs
Shell is now working in ::VFS:: mode
user@THISPC:/$
```

- Чтобы выйти из эмулятора, используйте команду `exit`.
```
user@THISPC:~$ exit
```

### Создание VFS файлов

VFS файлы следуют стандарту XML. Они дожны иметь объявление XML, которое *обязательно* должно находиться в первой строке, и корень файловой системы `rootdir`.<br/>
Пример:
```
<?xml version='1.0'?>

<rootdir>
</rootdir>
```
***Всё что описано далее, должно находиться внутри границ корневого элемента `rootdir`.***<br/>
Чтобы определить директорию, создайте тег `dir` и укажите имя в атрибуте `name`. В элемент директории могут быть вложены файлы или другие директории. Файл можно определить тегом `file`, а имя файла - тем же атрибутом `name`. Все символьные данные, вложенные в элемент `file`, считаются содержимым этого файла в VFS.
```
<dir name="myfolder">
    <dir name="anotherfolder">
        ...
    </dir>
    <file name="myfile1">This is my file</file>
    <file name="myfile2"/>
</dir>
```
*Обратите внимание: в этом примере файл `myfile2` является пустым.*<br/>
Чтобы пивести ваш VFS к двоичному виду, перекодируйте его в формат **base64**.