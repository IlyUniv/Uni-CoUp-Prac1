# Конфигурационное управление: практическая работа 1
***Вариант №9***<br/>
**Этап 3. VFS**

Программа `shell.py` представляет собой эмулятор для языка оболочки ОС, работа с которым напоминает работу в командной строке UNIX-подобной ОС.<br/>
На данный момент разработан минимальный прототип. Большинство функций в нем пока
представляют собой заглушки, но диалог с пользователем уже поддерживается. Так же есть возможность настройки эмулятора через параметры запуска, позволяющей выборать файл VFS (работа с которыми пока ещё в разработке) и выполнить определенный стартовый скрипт.<br/>

## Функционал

- При запуске данной программы высвечивается приглашение к вводу, которое содержит следующую информацию: имя пользователя, от имени которого запущен скрипт; имя хоста; путь до рабочей директории.<br/>
Вот как к примеру будет выглядеть приглашение к вводу пользователя `user` на машине с именем `THISPC`, если программа запущена из его домашней директории (`~`):
```
user@THISPC:~$
```

- Реализованы команды-заглушки, которые выводят свое имя и аргументы: `ls`, `cd`.
```
user@THISPC:~$ cd abc def gh
cd ['abc', 'def', 'gh']
user@THISPC:~$ ls qwert
ls ['qwert']
user@THISPC:~$
```

- Реализована поддержка кавычек для команд.
```
user@THISPC:~$ cd "qwerty uiop" asdf hj
cd ['qwerty uiop', 'asdf', 'hj']
user@THISPC:~$
```

- При некорректной расстановке кавычек парсер оповестит пользователя об ошибке.
```
user@THISPC:~$ ls "uiop
Parser error: No closing quotation
user@THISPC:~$
```

- Пользователь может завершить работу программы командой `exit`.
```
user@THISPC:~$ exit
```

- Эмулятор умеет работать со стартовыми скриптами, которые представляют из себя набор команд для выполнения после загрузки эмулятора. В стартовых скриптах можно оставлять коментарии при помощи `#`. Ниже приведен пример подобного скрипта:
```
# This is a comment
cd ~/git
ls kisscm
```

- Пользователю предоставляется возможность указать путь до файла VFS и стартового скрипта в параметрах запуска эмулятора.
```
$ python3 shell.py --vfs=/путь/до/vfs --script=/путь/до/стартового/скрипта
```

- VFS полностью поддерживаются как и в двоичном виде, так и в формате XML (в последующих примерах отражена работа со стандартными файлами проекта defaultvfs.xml и defaultvfs.bin)
```
$ python3 shell.py --vfs=defaultvfs.xml
[VFS] Built: {'dir1': {'readme.txt': 'Thank you for reading', 'test.pdp': ''}, 'stuff': {'assignment.docx': 'i assign', 'project': {'main.lua': '', 'lib.so': '', 'res': {}}, 'hobbies.pptx': ''}, 'VFSVERSION': 'XML'}
```
```
$ python3 shell.py --vfs=defaultvfs.bin
[VFS] Built: {'dir1': {'readme.txt': 'Thank you for reading', 'test.pdp': ''}, 'stuff': {'assignment.docx': 'i assign', 'project': {'main.lua': '', 'lib.so': '', 'res': {}}, 'hobbies.pptx': ''}, 'VFSVERSION': 'BINARY'}
```

## Запуск

### Быстрый старт

Для запуска и корректной работы эмулятора необходима <a href='https://www.python.org/downloads/'>актуальная версия Python 3</a>.

После установки Python (если потребовалось) склонируйте репозиторий (`git clone https://github.com/IlyUniv/Uni-CoUp-Prac1.git`) а затем запустите скрипт `shell.py` в его корневой директории:
```
cd Uni-CoUp-Prac1
python3 shell.py
```

### Параметры запуска

| Параметр | Описание |
| --- | --- |
| `-h`, `--help` | Показать помощь |
| `--vfs=VFS`, `--vfs VFS` | Абсолютный или относительный путь к файлу VFS |
| `--script=SCRIPT`, `--script SCRIPT` | Абсолютный или относительный путь к стартовому скрипту |

###  Скрипты запуска

В репозитории есть несколько скриптов для быстрого запуска или тестирования программы:

- `start_cwdscript.sh`: запускает эмулятор, который ищет стартовый скрипт `shellscript` в рабочем каталоге (для тестирования данной функции, запускаемых в стартовом скрипте, в корне репозитория располагается одноименный стартовый скрипт).

- `start_default.sh`: запускает эмулятор со стандартными файлом VFS (`defaultvfs.xml`) и стартовым скриптом, в котором тестируются все режимы команд (`scripts/default`).

- `start_shellemu.sh`: запускает эмулятор со скриптом `shellscript` и файлом VFS `vfs.xml` в директории `shellemu` пользователя (удобно для создания отдельных конфигураций эмулятора для каждого пользователя).

- `start_vfstest_minimal.sh`: запускает эмулятор с тестовым VFS: 0_minimal.xml
- `start_vfstest_fewfiles.sh`: запускает эмулятор с тестовым VFS: 1_fewfiles.xml
- `start_vfstest_nested.sh`: запускает эмулятор с тестовым VFS: 2_nested.xml

## Использование

### Использование эмулятора

- Использование команд-заглушек:
```
user@THISPC:~$ cd Documents
cd ['Documents']
user@THISPC:~$
```
```
user@THISPC:~$ ls "Shared Files"
ls ['Shared Files']
user@THISPC:~$
```

- Выход из эмулятора:
```
user@THISPC:~$ exit
```

### Создание VFS файлов

VFS файлы следуют стандарту XML. Они дожны иметь объявление XML, которое *обязательно* должно находиться в первой строке, и корень файловой системы `rootdir`.<br/>
Пример:
```
<?xml version='1.0'?>

<rootdir>
</rootdir>
```
***Всё что описано далее, должно находиться внутри границ корневого элемента `rootdir`.***<br/>
Чтобы определить директорию, создайте тег `dir` и укажите имя в атрибуте `name`. В элемент директории могут быть вложены файлы или другие директории. Файл можно определить тегом `file`, а имя файла - тем же атрибутом `name`. Все символьные данные, вложенные в элемент `file`, считаются содержимым этого файла в VFS.
```
<dir name="myfolder">
    <dir name="anotherfolder">
        ...
    </dir>
    <file name="myfile1">This is my file</file>
    <file name="myfile2"/>
</dir>
```
*Обратите внимание: в этом примере файл `myfile2` является пустым.*<br/>
Чтобы пивести ваш VFS к двоичному виду, перекодируйте его в формат **base64**.